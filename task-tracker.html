<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Трекер Задач</title>
    
    <!-- PWA Meta теги -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Трекер Задач">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Иконки для разных устройств -->
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXIpIiByeD0iMzAiLz4KPHA+PC9wPjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InBhaW50MF9saW5lYXIiIHgxPSIwIiB5MT0iMCIgeDI9IjE4MCIgeTI9IjE4MCIgZ3JhZGllbnRVbml0cz0idXNlclNwYWNlT25Vc2UiPgo8c3RvcCBzdG9wLWNvbG9yPSIjNjY3RUVBIi8+CjxzdG9wIG9mZnNldD0iMSIgc3RvcC1jb2xvcj0iIzc2NEJBMiIvPgo8L2xpbmVhckdyYWRpZW50Pgo8L2RlZnM+Cjwvc3ZnPgo=">
    
    <!-- Manifest для PWA -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogItCi0YDQtdC60LXRgCDQl9Cw0LTQsNGHIiwKICAic2hvcnRfbmFtZSI6ICLQotGA0LXQutC10YAiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgImJhY2tncm91bmRfY29sb3IiOiAiI2Y5ZmFmYiIsCiAgInRoZW1lX2NvbG9yIjogIiMzYjgyZjYiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNVGd3SWlCb1pXbG5hSFE5SWpFNE1DSWlJSFpwWlhkQ2IzZzlJakFnTUNBeE9EQWdNVGd3SWlCbWFXeHNQU0p1YjI1bElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaVBnbzhjbVZqZENCM2FXUjBhRDBpTVRnd0lpQm9aV2xuYUhROUlqRTRNQ0lpSUdacGJHdzlJblZ5YkNnaGNHRnBiblF3WDJ4cGJtVmhjaWtpSUhKNFBTSXpNQ0l2UGdvOGNEND1hZG1KcGJnPT08TDNBK1BHUmxabU0rQ2p4c2FXNWxZWEpIY21Ga2FXVnVkQ0JwWkQwaWNHRnBiblF3WDJ4cGJtVmhjaUlnZURFOUlqQWlJSGt4UFNJZ0lpQjRNajBpTVRnd0lpQjVNajBpTVRnd0lpQm5jbUZrYVdWdWRGVnVhWFJ6UFNKMWMyVnlVM0JoWTJWUGJsVnpaU0krQ2p4emRHOXdJSE4wYjNBdFkyOXNiM0k5SWlNMk5qZEZSVUVpTHo0S1BITjBiM0FnYjJabWMyVjBQU0l4SWlCemRHOXdMV052Ykc5eVBTSWpOelkwUWtFeUlpOCtDand2YkdsdVpXRnlSM0poWkdsbGJuUSNDand2WkdWbWN6NEtQQzl6ZG1jKw==IiwKICAgICAgInNpemVzIjogIjE4MHgxODAiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQo=">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .font-system {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        /* Иконки SVG встроенные */
        .icon-search { display: inline-block; width: 16px; height: 16px; }
        .icon-plus { display: inline-block; width: 16px; height: 16px; }
        .icon-x { display: inline-block; width: 16px; height: 16px; }
        .icon-edit { display: inline-block; width: 16px; height: 16px; }
        .icon-filter { display: inline-block; width: 16px; height: 16px; }
        .icon-chevron { display: inline-block; width: 16px; height: 16px; }
        .icon-command { display: inline-block; width: 10px; height: 10px; }
        
        body {
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="root">
        <div style="display: flex; align-items: center; justify-content: center; height: 100vh; font-family: -apple-system, BlinkMacSystemFont, sans-serif;">
            <div>Загрузка приложения...</div>
        </div>
    </div>

    <script type="text/babel">
        // Простые иконки в виде SVG компонентов
        const Search = () => (
            <svg className="icon-search" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Plus = () => (
            <svg className="icon-plus" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M12 5v14M5 12h14"></path>
            </svg>
        );

        const X = () => (
            <svg className="icon-x" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M18 6L6 18M6 6l12 12"></path>
            </svg>
        );

        const Edit3 = () => (
            <svg className="icon-edit" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
        );

        const Filter = () => (
            <svg className="icon-filter" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polygon points="22,3 2,3 10,12.46 10,19 14,21 14,12.46"></polygon>
            </svg>
        );

        const ChevronDown = () => (
            <svg className="icon-chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <polyline points="6,9 12,15 18,9"></polyline>
            </svg>
        );

        const Command = () => (
            <svg className="icon-command" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"></path>
            </svg>
        );

        const TaskTracker = () => {
            const [tabs, setTabs] = React.useState([
                { id: 1, name: 'Рабочие задачи', tasks: [] },
                { id: 2, name: 'Личные дела', tasks: [] }
            ]);
            const [activeTab, setActiveTab] = React.useState(1);
            const [searchTerm, setSearchTerm] = React.useState('');
            const [filterStatus, setFilterStatus] = React.useState('all');
            const [isCreatingTab, setIsCreatingTab] = React.useState(false);
            const [newTabName, setNewTabName] = React.useState('');

            const statusConfig = {
                pending: { name: 'В ожидании', color: 'bg-gray-100 text-gray-700 border-gray-200', dot: 'bg-gray-400' },
                inProgress: { name: 'Выполняется', color: 'bg-yellow-50 text-yellow-800 border-yellow-200', dot: 'bg-yellow-400' },
                completed: { name: 'Готово', color: 'bg-green-50 text-green-800 border-green-200', dot: 'bg-green-400' }
            };

            const priorityConfig = {
                low: { name: 'Низкий', color: 'border-l-gray-300' },
                medium: { name: 'Средний', color: 'border-l-blue-400' },
                high: { name: 'Высокий', color: 'border-l-red-400' }
            };

            // Сохранение данных
            React.useEffect(() => {
                try {
                    const savedTabs = localStorage.getItem('taskTrackerTabs');
                    if (savedTabs) {
                        setTabs(JSON.parse(savedTabs));
                    }
                    const savedActiveTab = localStorage.getItem('taskTrackerActiveTab');
                    if (savedActiveTab) {
                        setActiveTab(parseInt(savedActiveTab));
                    }
                } catch (e) {
                    console.log('Ошибка загрузки данных:', e);
                }
            }, []);

            React.useEffect(() => {
                try {
                    localStorage.setItem('taskTrackerTabs', JSON.stringify(tabs));
                    localStorage.setItem('taskTrackerActiveTab', activeTab.toString());
                } catch (e) {
                    console.log('Ошибка сохранения данных:', e);
                }
            }, [tabs, activeTab]);

            // Горячие клавиши
            React.useEffect(() => {
                const handleKeyDown = (e) => {
                    if (e.metaKey && e.key === 'k') {
                        e.preventDefault();
                        const searchInput = document.getElementById('search-input');
                        if (searchInput) searchInput.focus();
                    }
                    if (e.metaKey && e.key === 'n') {
                        e.preventDefault();
                        addTask();
                    }
                };

                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, [activeTab]);

            const getCurrentTab = () => tabs.find(tab => tab.id === activeTab);

            const addTask = () => {
                const taskText = prompt('Введите текст задачи:');
                if (!taskText) return;

                const newTask = {
                    id: Date.now(),
                    text: taskText,
                    status: 'pending',
                    priority: 'medium',
                    createdAt: new Date().toISOString()
                };

                setTabs(tabs.map(tab => 
                    tab.id === activeTab 
                        ? { ...tab, tasks: [...tab.tasks, newTask] }
                        : tab
                ));
            };

            const updateTaskStatus = (taskId, newStatus) => {
                setTabs(tabs.map(tab => 
                    tab.id === activeTab 
                        ? { ...tab, tasks: tab.tasks.map(task => 
                            task.id === taskId ? { ...task, status: newStatus } : task
                        )}
                        : tab
                ));
            };

            const updateTaskPriority = (taskId, newPriority) => {
                setTabs(tabs.map(tab => 
                    tab.id === activeTab 
                        ? { ...tab, tasks: tab.tasks.map(task => 
                            task.id === taskId ? { ...task, priority: newPriority } : task
                        )}
                        : tab
                ));
            };

            const editTask = (task) => {
                const newText = prompt('Редактировать задачу:', task.text);
                if (newText && newText !== task.text) {
                    setTabs(tabs.map(tab => 
                        tab.id === activeTab 
                            ? { ...tab, tasks: tab.tasks.map(t => 
                                t.id === task.id ? { ...t, text: newText } : t
                            )}
                            : tab
                    ));
                }
            };

            const deleteTask = (taskId) => {
                if (confirm('Удалить задачу?')) {
                    setTabs(tabs.map(tab => 
                        tab.id === activeTab 
                            ? { ...tab, tasks: tab.tasks.filter(task => task.id !== taskId) }
                            : tab
                    ));
                }
            };

            const addTab = () => {
                if (newTabName.trim()) {
                    const newTab = {
                        id: Date.now(),
                        name: newTabName.trim(),
                        tasks: []
                    };
                    setTabs([...tabs, newTab]);
                    setActiveTab(newTab.id);
                    setNewTabName('');
                    setIsCreatingTab(false);
                }
            };

            const deleteTab = (tabId) => {
                if (tabs.length > 1 && confirm('Удалить вкладку со всеми задачами?')) {
                    const newTabs = tabs.filter(tab => tab.id !== tabId);
                    setTabs(newTabs);
                    if (activeTab === tabId) {
                        setActiveTab(newTabs[0].id);
                    }
                }
            };

            const editTab = (tabId) => {
                const tab = tabs.find(t => t.id === tabId);
                const newName = prompt('Новое название вкладки:', tab.name);
                if (newName && newName !== tab.name) {
                    setTabs(tabs.map(t => 
                        t.id === tabId ? { ...t, name: newName } : t
                    ));
                }
            };

            const getFilteredTasks = () => {
                const currentTab = getCurrentTab();
                if (!currentTab) return [];

                let filtered = currentTab.tasks;

                if (searchTerm) {
                    filtered = filtered.filter(task => 
                        task.text.toLowerCase().includes(searchTerm.toLowerCase())
                    );
                }

                if (filterStatus !== 'all') {
                    filtered = filtered.filter(task => task.status === filterStatus);
                }

                return filtered;
            };

            const getStatusCounts = () => {
                const currentTab = getCurrentTab();
                if (!currentTab) return {};

                return currentTab.tasks.reduce((counts, task) => {
                    counts[task.status] = (counts[task.status] || 0) + 1;
                    return counts;
                }, {});
            };

            const statusCounts = getStatusCounts();
            const filteredTasks = getFilteredTasks();

            return (
                <div className="min-h-screen bg-gray-50 font-system">
                    {/* Header */}
                    <div className="bg-white border-b border-gray-200 sticky top-0 z-10">
                        <div className="max-w-6xl mx-auto px-6 py-4">
                            <div className="flex items-center justify-between mb-4">
                                <h1 className="text-2xl font-semibold text-gray-900">Трекер Задач</h1>
                                <div className="flex items-center gap-2 text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">
                                    <Command />
                                    <span>⌘K поиск, ⌘N новая задача</span>
                                </div>
                            </div>

                            {/* Вкладки */}
                            <div className="flex items-center gap-2 mb-4 flex-wrap">
                                {tabs.map(tab => (
                                    <div key={tab.id} className="flex items-center">
                                        <button
                                            onClick={() => setActiveTab(tab.id)}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                activeTab === tab.id 
                                                    ? 'bg-blue-100 text-blue-700 border border-blue-200' 
                                                    : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'
                                            }`}
                                        >
                                            {tab.name}
                                            {tab.tasks.length > 0 && (
                                                <span className="ml-2 px-2 py-0.5 bg-gray-200 text-xs rounded-full">
                                                    {tab.tasks.length}
                                                </span>
                                            )}
                                        </button>
                                        <div className="ml-1 flex">
                                            <button 
                                                onClick={() => editTab(tab.id)}
                                                className="p-1 text-gray-400 hover:text-gray-600"
                                            >
                                                <Edit3 />
                                            </button>
                                            {tabs.length > 1 && (
                                                <button 
                                                    onClick={() => deleteTab(tab.id)}
                                                    className="p-1 text-gray-400 hover:text-red-500"
                                                >
                                                    <X />
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ))}
                                
                                {isCreatingTab ? (
                                    <div className="flex items-center gap-2">
                                        <input
                                            type="text"
                                            value={newTabName}
                                            onChange={(e) => setNewTabName(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && addTab()}
                                            placeholder="Название вкладки"
                                            className="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            autoFocus
                                        />
                                        <button onClick={addTab} className="text-green-600 hover:text-green-700 p-1">
                                            <Plus />
                                        </button>
                                        <button onClick={() => setIsCreatingTab(false)} className="text-gray-400 hover:text-gray-600 p-1">
                                            <X />
                                        </button>
                                    </div>
                                ) : (
                                    <button
                                        onClick={() => setIsCreatingTab(true)}
                                        className="px-3 py-2 text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg border border-dashed border-blue-300"
                                    >
                                        + Добавить вкладку
                                    </button>
                                )}
                            </div>

                            {/* Поиск и фильтры */}
                            <div className="flex items-center gap-4 flex-wrap">
                                <div className="relative flex-1 max-w-md min-w-64">
                                    <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <Search />
                                    </div>
                                    <input
                                        id="search-input"
                                        type="text"
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                        placeholder="Поиск задач... (⌘K)"
                                        className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full"
                                    />
                                </div>

                                <div className="relative">
                                    <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                        <Filter />
                                    </div>
                                    <select
                                        value={filterStatus}
                                        onChange={(e) => setFilterStatus(e.target.value)}
                                        className="pl-10 pr-8 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent appearance-none bg-white min-w-40"
                                    >
                                        <option value="all">Все задачи</option>
                                        <option value="pending">В ожидании</option>
                                        <option value="inProgress">Выполняется</option>
                                        <option value="completed">Готово</option>
                                    </select>
                                    <div className="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 pointer-events-none">
                                        <ChevronDown />
                                    </div>
                                </div>

                                <button
                                    onClick={addTask}
                                    className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors"
                                >
                                    <Plus />
                                    Добавить задачу
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* Статистика */}
                    <div className="max-w-6xl mx-auto px-6 py-6">
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <div className="bg-white p-4 rounded-xl border border-gray-200">
                                <div className="flex items-center justify-between">
                                    <span className="text-sm text-gray-600">Всего задач</span>
                                    <span className="text-2xl font-bold text-gray-900">
                                        {getCurrentTab()?.tasks.length || 0}
                                    </span>
                                </div>
                            </div>
                            {Object.entries(statusConfig).map(([status, config]) => (
                                <div key={status} className="bg-white p-4 rounded-xl border border-gray-200">
                                    <div className="flex items-center justify-between">
                                        <div className="flex items-center gap-2">
                                            <div className={`w-3 h-3 rounded-full ${config.dot}`}></div>
                                            <span className="text-sm text-gray-600">{config.name}</span>
                                        </div>
                                        <span className="text-2xl font-bold text-gray-900">
                                            {statusCounts[status] || 0}
                                        </span>
                                    </div>
                                </div>
                            ))}
                        </div>

                        {/* Список задач */}
                        <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
                            {filteredTasks.length === 0 ? (
                                <div className="p-8 text-center text-gray-500">
                                    {searchTerm || filterStatus !== 'all' 
                                        ? 'Задачи не найдены' 
                                        : 'Нет задач. Создайте первую задачу!'}
                                </div>
                            ) : (
                                <div className="divide-y divide-gray-100">
                                    {filteredTasks.map(task => (
                                        <div key={task.id} className={`p-4 hover:bg-gray-50 transition-colors border-l-4 ${priorityConfig[task.priority].color}`}>
                                            <div className="flex items-start justify-between gap-4">
                                                <div className="flex items-start gap-3 flex-1 min-w-0">
                                                    <div className="flex items-center gap-2 flex-shrink-0">
                                                        <span className={`px-3 py-1 text-xs font-medium rounded-full border ${statusConfig[task.status].color}`}>
                                                            {statusConfig[task.status].name}
                                                        </span>
                                                        <select
                                                            value={task.priority}
                                                            onChange={(e) => updateTaskPriority(task.id, e.target.value)}
                                                            className="text-xs border border-gray-200 rounded px-2 py-1 focus:ring-1 focus:ring-blue-500"
                                                        >
                                                            {Object.entries(priorityConfig).map(([priority, config]) => (
                                                                <option key={priority} value={priority}>{config.name}</option>
                                                            ))}
                                                        </select>
                                                    </div>
                                                    <div className="min-w-0 flex-1">
                                                        <div className={`break-words ${task.status === 'completed' ? 'line-through text-gray-500' : 'text-gray-900'}`}>
                                                            {task.text}
                                                        </div>
                                                        <div className="mt-2 text-xs text-gray-400">
                                                            Создано: {new Date(task.createdAt).toLocaleString('ru-RU')}
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div className="flex items-center gap-2 flex-shrink-0">
                                                    <select
                                                        value={task.status}
                                                        onChange={(e) => updateTaskStatus(task.id, e.target.value)}
                                                        className="text-sm border border-gray-200 rounded px-3 py-1 focus:ring-2 focus:ring-blue-500"
                                                    >
                                                        {Object.entries(statusConfig).map(([status, config]) => (
                                                            <option key={status} value={status}>{config.name}</option>
                                                        ))}
                                                    </select>
                                                    <button
                                                        onClick={() => editTask(task)}
                                                        className="p-2 text-gray-400 hover:text-blue-600 transition-colors"
                                                    >
                                                        <Edit3 />
                                                    </button>
                                                    <button
                                                        onClick={() => deleteTask(task.id)}
                                                        className="p-2 text-gray-400 hover:text-red-500 transition-colors"
                                                    >
                                                        <X />
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // Проверяем загрузку React и запускаем приложение
        if (typeof React !== 'undefined' && typeof ReactDOM !== 'undefined') {
            ReactDOM.render(React.createElement(TaskTracker), document.getElementById('root'));
        } else {
            document.getElementById('root').innerHTML = '<div style="padding: 20px; text-align: center; color: red;">Ошибка загрузки библиотек React. Проверьте подключение к интернету.</div>';
        }
    </script>
</body>
</html>